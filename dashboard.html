<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Reclutadores — Huella Laboral</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --azul: #0E2A47;
            --azul-hover: #0a1f35;
            --azul-light: rgba(14,42,71,0.06);
            --verde: #2FBF71;
            --texto: #2E2E2E;
            --subtitulo: #6B7280;
            --fondo: #FFFFFF;
            --fondo-gris: #F7F8FA;
            --borde: #E5E7EB;
            --error: #EF4444;
            --sidebar-width: 240px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--fondo-gris);
            color: var(--texto);
            font-size: 15px;
            line-height: 1.5;
            min-height: 100vh;
        }

        .app { display: flex; min-height: 100vh; }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--azul);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0; left: 0;
            height: 100vh;
            z-index: 50;
        }

        .sidebar-logo {
            padding: 24px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .sidebar-logo-text { font-size: 16px; font-weight: 700; color: white; letter-spacing: -0.3px; }

        .sidebar-nav {
            flex: 1;
            padding: 16px 12px;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .sidebar-section-label {
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: rgba(255,255,255,0.4);
            padding: 12px 8px 6px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 9px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.15s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-family: 'Inter', sans-serif;
        }

        .sidebar-item:hover { background: rgba(255,255,255,0.08); }
        .sidebar-item.active { background: rgba(255,255,255,0.15); }
        .sidebar-item-text { font-size: 14px; font-weight: 500; color: rgba(255,255,255,0.8); }
        .sidebar-item.active .sidebar-item-text { color: white; }
        .sidebar-item svg { flex-shrink: 0; opacity: 0.7; }
        .sidebar-item.active svg { opacity: 1; }

        .sidebar-footer {
            padding: 16px 12px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-user { padding: 10px; }
        .sidebar-user-name { font-size: 13px; font-weight: 500; color: white; }
        .sidebar-user-email { font-size: 11px; color: rgba(255,255,255,0.5); margin-top: 1px; }

        .btn-logout {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            font-weight: 500;
            color: rgba(255,255,255,0.6);
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px 10px 0;
            text-align: left;
            transition: color 0.15s;
        }

        .btn-logout:hover { color: white; }

        /* MAIN */
        .main {
            margin-left: var(--sidebar-width);
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* TOPBAR */
        .topbar {
            background: var(--fondo);
            border-bottom: 1px solid var(--borde);
            padding: 0 32px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 40;
        }

        .topbar-title { font-size: 16px; font-weight: 700; color: var(--azul); }
        .topbar-actions { display: flex; align-items: center; gap: 12px; }

        .btn-primary {
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            font-weight: 500;
            color: white;
            background: var(--azul);
            border: 2px solid var(--azul);
            border-radius: 4px;
            padding: 7px 16px;
            cursor: pointer;
            transition: background 0.15s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary:hover { background: var(--azul-hover); border-color: var(--azul-hover); }

        .btn-outline {
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            font-weight: 500;
            color: var(--azul);
            background: transparent;
            border: 2px solid var(--azul);
            border-radius: 4px;
            padding: 7px 16px;
            cursor: pointer;
            transition: background 0.15s, color 0.15s;
        }

        .btn-outline:hover { background: var(--azul); color: white; }

        /* CONTENT */
        .content { padding: 32px; flex: 1; }

        .vista { display: none; }
        .vista.active { display: block; }

        /* STATS */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 28px;
        }

        .stat-card {
            background: var(--fondo);
            border: 1px solid var(--borde);
            border-radius: 4px;
            padding: 20px 24px;
        }

        .stat-label {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--subtitulo);
            margin-bottom: 8px;
        }

        .stat-value { font-size: 28px; font-weight: 700; color: var(--azul); line-height: 1; }

        /* TABLA */
        .table-card {
            background: var(--fondo);
            border: 1px solid var(--borde);
            border-radius: 4px;
            overflow: hidden;
        }

        table { width: 100%; border-collapse: collapse; }

        thead { background: var(--fondo-gris); border-bottom: 1px solid var(--borde); }

        th {
            text-align: left;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--subtitulo);
            padding: 12px 20px;
        }

        td {
            padding: 14px 20px;
            font-size: 14px;
            color: var(--texto);
            border-bottom: 1px solid var(--borde);
        }

        tr:last-child td { border-bottom: none; }
        tbody tr { transition: background 0.1s; }
        tbody tr:hover { background: var(--fondo-gris); }

        .td-name { font-weight: 500; color: var(--azul); }
        .td-sub { font-size: 12px; color: var(--subtitulo); margin-top: 1px; }

        /* BADGES */
        .badge {
            display: inline-block;
            font-size: 11px;
            font-weight: 700;
            padding: 3px 9px;
            border-radius: 2px;
        }

        .badge-activo, .badge-completado { background: rgba(47,191,113,0.12); color: #166534; }
        .badge-en-proceso { background: rgba(234,179,8,0.12); color: #854d0e; }
        .badge-invitado { background: rgba(107,114,128,0.12); color: var(--subtitulo); }

        .btn-accion {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            font-weight: 500;
            color: var(--azul);
            background: transparent;
            border: 1px solid var(--borde);
            border-radius: 4px;
            padding: 5px 12px;
            cursor: pointer;
            transition: border-color 0.15s, background 0.15s;
        }

        .btn-accion:hover { border-color: var(--azul); background: var(--azul-light); }

        /* BACK */
        .btn-back {
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            font-weight: 500;
            color: var(--subtitulo);
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 24px;
            padding: 0;
            transition: color 0.15s;
        }

        .btn-back:hover { color: var(--azul); }

        /* PROCESO HEADER */
        .proceso-header {
            background: var(--fondo);
            border: 1px solid var(--borde);
            border-radius: 4px;
            padding: 24px 28px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .proceso-nombre { font-size: 20px; font-weight: 700; color: var(--azul); margin-bottom: 4px; }
        .proceso-meta { font-size: 13px; color: var(--subtitulo); }

        /* CANDIDATO HEADER */
        .candidato-header {
            background: var(--azul);
            border-radius: 4px;
            padding: 24px 28px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .candidato-avatar {
            width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .candidato-nombre { font-size: 18px; font-weight: 700; color: white; margin-bottom: 2px; }
        .candidato-meta { font-size: 13px; color: rgba(255,255,255,0.7); }

        /* PROMEDIOS */
        .promedios-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .promedio-card {
            background: var(--fondo);
            border: 1px solid var(--borde);
            border-radius: 4px;
            padding: 20px 24px;
        }

        .promedio-label {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--subtitulo);
            margin-bottom: 12px;
        }

        .promedio-valor { font-size: 36px; font-weight: 700; color: var(--azul); line-height: 1; margin-bottom: 10px; }

        .promedio-barra { height: 6px; background: var(--borde); border-radius: 3px; overflow: hidden; }
        .promedio-fill { height: 100%; background: var(--azul); border-radius: 3px; transition: width 0.6s ease; }

        /* EVALUACIONES */
        .evaluacion-card {
            background: var(--fondo);
            border: 1px solid var(--borde);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .evaluacion-card:last-child { margin-bottom: 0; }

        .evaluacion-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--borde);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .evaluacion-evaluador { font-size: 14px; font-weight: 700; color: var(--azul); }
        .evaluacion-empresa { font-size: 12px; color: var(--subtitulo); margin-top: 2px; }
        .evaluacion-fecha { font-size: 12px; color: var(--subtitulo); }
        .evaluacion-body { padding: 20px; }

        .eval-atributos {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 0;
        }

        .eval-atributo-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--subtitulo);
            margin-bottom: 6px;
        }

        .eval-score { display: flex; align-items: center; gap: 8px; }
        .eval-score-num { font-size: 20px; font-weight: 700; color: var(--azul); min-width: 28px; }
        .eval-score-bar { flex: 1; height: 4px; background: var(--borde); border-radius: 2px; overflow: hidden; }
        .eval-score-fill { height: 100%; background: var(--azul); border-radius: 2px; }
        .eval-score-texto { font-size: 11px; color: var(--subtitulo); margin-top: 4px; }

        .eval-comentario {
            font-size: 13px;
            color: var(--subtitulo);
            background: var(--fondo-gris);
            border-left: 3px solid var(--borde);
            padding: 8px 12px;
            border-radius: 0 4px 4px 0;
            margin-top: 8px;
            line-height: 1.5;
        }

        .eval-otros {
            border-top: 1px solid var(--borde);
            padding-top: 16px;
            margin-top: 16px;
        }

        .eval-otros-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--subtitulo);
            margin-bottom: 6px;
        }

        .eval-otros-texto { font-size: 13px; color: var(--texto); line-height: 1.6; }

        .no-conoce-tag {
            background: rgba(239,68,68,0.08);
            border: 1px solid rgba(239,68,68,0.2);
            border-radius: 4px;
            padding: 10px 14px;
            font-size: 13px;
            color: #b91c1c;
        }

        /* BÚSQUEDA */
        .rut-search-card {
            background: var(--fondo);
            border: 1px solid var(--borde);
            border-radius: 4px;
            padding: 32px;
            max-width: 480px;
            margin-bottom: 28px;
        }

        .rut-search-title { font-size: 16px; font-weight: 700; color: var(--azul); margin-bottom: 6px; }
        .rut-search-desc { font-size: 14px; color: var(--subtitulo); margin-bottom: 20px; }
        .rut-search-form { display: flex; gap: 10px; }

        .rut-search-input {
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            color: var(--texto);
            background: var(--fondo);
            border: 1px solid var(--borde);
            border-radius: 4px;
            padding: 10px 14px;
            flex: 1;
            transition: border-color 0.15s, box-shadow 0.15s;
        }

        .rut-search-input:focus { outline: none; border-color: var(--azul); box-shadow: 0 0 0 3px rgba(14,42,71,0.08); }

        /* EMPTY */
        .empty-state { text-align: center; padding: 48px 24px; }
        .empty-state-title { font-size: 15px; font-weight: 700; color: var(--azul); margin-bottom: 6px; }
        .empty-state-desc { font-size: 13px; color: var(--subtitulo); }

        /* MODALES */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .modal-overlay.visible { display: flex; }

        .modal {
            background: var(--fondo);
            border-radius: 4px;
            width: 100%;
            max-width: 480px;
            overflow: hidden;
        }

        .modal-header {
            background: var(--azul);
            padding: 20px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title { font-size: 16px; font-weight: 700; color: white; }

        .btn-close-modal {
            background: none;
            border: none;
            cursor: pointer;
            color: rgba(255,255,255,0.7);
            transition: color 0.15s;
            display: flex;
        }

        .btn-close-modal:hover { color: white; }

        .modal-body { padding: 24px; }

        .modal-form-group { margin-bottom: 18px; }
        .modal-form-group:last-child { margin-bottom: 0; }
        .modal-label { font-size: 13px; font-weight: 500; color: var(--texto); margin-bottom: 6px; display: block; }
        .modal-label-opt { font-size: 11px; font-weight: 400; color: var(--subtitulo); }

        .modal-input {
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            color: var(--texto);
            background: var(--fondo);
            border: 1px solid var(--borde);
            border-radius: 4px;
            padding: 10px 14px;
            width: 100%;
            transition: border-color 0.15s;
        }

        .modal-input:focus { outline: none; border-color: var(--azul); box-shadow: 0 0 0 3px rgba(14,42,71,0.08); }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--borde);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main { margin-left: 0; }
            .stats-row { grid-template-columns: 1fr 1fr; }
            .promedios-grid { grid-template-columns: 1fr; }
            .eval-atributos { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="app">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <a href="index.html" class="sidebar-logo">
            <img src="Huella_Laboral.png" alt="Huella Laboral" style="height:36px; width:auto;">
        </a>

        <nav class="sidebar-nav">
            <div class="sidebar-section-label">Principal</div>
            <button class="sidebar-item active" id="nav-procesos" onclick="mostrarVista('procesos')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="7" width="20" height="14" rx="2"/>
                    <path d="M16 3H8L2 7h20z"/>
                </svg>
                <span class="sidebar-item-text">Procesos</span>
            </button>
            <button class="sidebar-item" id="nav-busqueda" onclick="mostrarVista('busqueda')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                </svg>
                <span class="sidebar-item-text">Buscar por RUT</span>
            </button>
        </nav>

        <div class="sidebar-footer">
            <div class="sidebar-user">
                <div class="sidebar-user-name" id="sidebarNombre">Reclutador</div>
                <div class="sidebar-user-email" id="sidebarEmail"></div>
            </div>
            <button class="btn-logout" onclick="cerrarSesion()">Cerrar sesión</button>
        </div>
    </aside>

    <!-- MAIN -->
    <main class="main">

        <div class="topbar">
            <div class="topbar-title" id="topbarTitle">Procesos</div>
            <div class="topbar-actions" id="topbarActions">
                <button class="btn-primary" onclick="abrirModalProceso()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round"><path d="M12 5v14M5 12h14"/></svg>
                    Nuevo proceso
                </button>
            </div>
        </div>

        <div class="content">

            <!-- VISTA PROCESOS -->
            <div class="vista active" id="vista-procesos">
                <div class="stats-row">
                    <div class="stat-card"><div class="stat-label">Procesos activos</div><div class="stat-value" id="statProcesosActivos">—</div></div>
                    <div class="stat-card"><div class="stat-label">Total candidatos</div><div class="stat-value" id="statCandidatos">—</div></div>
                    <div class="stat-card"><div class="stat-label">Evaluaciones completas</div><div class="stat-value" id="statCompletadas">—</div></div>
                    <div class="stat-card"><div class="stat-label">En proceso</div><div class="stat-value" id="statEnProceso">—</div></div>
                </div>
                <div class="table-card">
                    <table>
                        <thead>
                            <tr>
                                <th>Proceso / Cargo</th>
                                <th>Candidatos</th>
                                <th>Estado</th>
                                <th>Fecha</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="tablaProcesos"></tbody>
                    </table>
                </div>
            </div>

            <!-- VISTA CANDIDATOS -->
            <div class="vista" id="vista-candidatos">
                <button class="btn-back" onclick="mostrarVista('procesos')">
                    <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 4L6 8l4 4"/></svg>
                    Volver a procesos
                </button>
                <div class="proceso-header">
                    <div>
                        <div class="proceso-nombre" id="procesoNombre">—</div>
                        <div class="proceso-meta" id="procesoMeta">—</div>
                    </div>
                    <button class="btn-primary" onclick="abrirModalCandidato()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round"><path d="M12 5v14M5 12h14"/></svg>
                        Agregar candidato
                    </button>
                </div>
                <div class="table-card">
                    <table>
                        <thead>
                            <tr>
                                <th>Candidato</th>
                                <th>Empleadores contactados</th>
                                <th>Evaluaciones recibidas</th>
                                <th>Estado</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="tablaCandidatos"></tbody>
                    </table>
                </div>
            </div>

            <!-- VISTA RESULTADOS -->
            <div class="vista" id="vista-resultados">
                <button class="btn-back" onclick="mostrarVista('candidatos')">
                    <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 4L6 8l4 4"/></svg>
                    Volver a candidatos
                </button>
                <div class="candidato-header">
                    <div class="candidato-avatar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="8" r="4"/>
                            <path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/>
                        </svg>
                    </div>
                    <div>
                        <div class="candidato-nombre" id="resultadoNombre">—</div>
                        <div class="candidato-meta" id="resultadoMeta">—</div>
                    </div>
                </div>
                <div class="promedios-grid">
                    <div class="promedio-card"><div class="promedio-label">Puntualidad</div><div class="promedio-valor" id="promPuntualidad">—</div><div class="promedio-barra"><div class="promedio-fill" id="barraPuntualidad" style="width:0%"></div></div></div>
                    <div class="promedio-card"><div class="promedio-label">Desempeño</div><div class="promedio-valor" id="promDesempeno">—</div><div class="promedio-barra"><div class="promedio-fill" id="barraDesempeno" style="width:0%"></div></div></div>
                    <div class="promedio-card"><div class="promedio-label">Confiabilidad</div><div class="promedio-valor" id="promConfiabilidad">—</div><div class="promedio-barra"><div class="promedio-fill" id="barraConfiabilidad" style="width:0%"></div></div></div>
                </div>
                <div id="listaEvaluaciones"></div>
            </div>

            <!-- VISTA BÚSQUEDA -->
            <div class="vista" id="vista-busqueda">
                <div class="rut-search-card">
                    <div class="rut-search-title">Consulta por RUT</div>
                    <div class="rut-search-desc">Busca cualquier trabajador en el sistema para consultar sus evaluaciones.</div>
                    <div class="rut-search-form">
                        <input type="text" class="rut-search-input" id="rutBusqueda" placeholder="12.345.678-9" maxlength="12">
                        <button class="btn-primary" onclick="buscarPorRut()">Buscar</button>
                    </div>
                </div>
                <div id="resultadoBusqueda"></div>
            </div>

        </div>
    </main>
</div>

<!-- MODAL NUEVO PROCESO -->
<div class="modal-overlay" id="modalProceso">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title">Nuevo proceso</span>
            <button class="btn-close-modal" onclick="cerrarModalProceso()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 6L6 18M6 6l12 12"/></svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="modal-form-group">
                <label class="modal-label" for="nuevoProcesoCargo">Nombre del cargo o búsqueda</label>
                <input type="text" class="modal-input" id="nuevoProcesoCargo" placeholder="Analista Comercial — Febrero 2026">
            </div>
            <div class="modal-form-group">
                <label class="modal-label" for="nuevoProcesoDesc">Descripción <span class="modal-label-opt">(opcional)</span></label>
                <input type="text" class="modal-input" id="nuevoProcesoDesc" placeholder="Área, departamento u otros detalles">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-outline" onclick="cerrarModalProceso()">Cancelar</button>
            <button class="btn-primary" onclick="crearProceso()">Crear proceso</button>
        </div>
    </div>
</div>

<!-- MODAL AGREGAR CANDIDATO -->
<div class="modal-overlay" id="modalCandidato">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title">Agregar candidato</span>
            <button class="btn-close-modal" onclick="cerrarModalCandidato()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 6L6 18M6 6l12 12"/></svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="modal-form-group">
                <label class="modal-label" for="candNombre">Nombre completo</label>
                <input type="text" class="modal-input" id="candNombre" placeholder="Juan Pérez González">
            </div>
            <div class="modal-form-group">
                <label class="modal-label" for="candRut">RUT</label>
                <input type="text" class="modal-input" id="candRut" placeholder="12.345.678-9">
            </div>
            <div class="modal-form-group">
                <label class="modal-label" for="candEmail">Correo electrónico</label>
                <input type="email" class="modal-input" id="candEmail" placeholder="candidato@correo.cl">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-outline" onclick="cerrarModalCandidato()">Cancelar</button>
            <button class="btn-primary" onclick="agregarCandidato()">Agregar y notificar</button>
        </div>
    </div>
</div>

<script>
    const escalaTextos = { 1: 'Muy mejorable', 2: 'Mejorable', 3: 'Suficiente', 4: 'Bueno', 5: 'Muy bueno' };

    // DATOS DEMO
    let procesos = [
        { id: 1, cargo: 'Analista Comercial', descripcion: 'Gerencia de ventas', estado: 'Activo', fecha: '2026-02-01', candidatos: 3 },
        { id: 2, cargo: 'Ingeniero de Proyectos', descripcion: 'Área de infraestructura', estado: 'Activo', fecha: '2026-01-15', candidatos: 2 },
    ];

    let candidatosPorProceso = {
        1: [
            { id: 1, nombre: 'María González', rut: '12.345.678-9', email: 'mgonzalez@mail.cl', empleadores: 3, evaluaciones: 3, estado: 'Completado' },
            { id: 2, nombre: 'Carlos Muñoz', rut: '15.432.100-K', email: 'cmunoz@mail.cl', empleadores: 2, evaluaciones: 1, estado: 'En proceso' },
            { id: 3, nombre: 'Andrea Soto', rut: '11.222.333-4', email: 'asoto@mail.cl', empleadores: 2, evaluaciones: 0, estado: 'Invitado' },
        ],
        2: [
            { id: 4, nombre: 'Roberto Lagos', rut: '9.876.543-2', email: 'rlagos@mail.cl', empleadores: 3, evaluaciones: 2, estado: 'En proceso' },
            { id: 5, nombre: 'Valentina Ríos', rut: '16.789.012-3', email: 'vrios@mail.cl', empleadores: 2, evaluaciones: 2, estado: 'Completado' },
        ]
    };

    let evaluacionesPorCandidato = {
        1: [
            { id: 1, evaluador: 'Jorge Herrera', empresa: 'Retail Norte S.A.', rut: '7.654.321-K', periodo: 'Mar 2021 — Dic 2023', no_conoce: false, puntualidad: { val: 5, comentario: 'Siempre puntual, sin ausencias injustificadas.' }, desempeno: { val: 4, comentario: 'Cumplió los objetivos del área con consistencia.' }, confiabilidad: { val: 5, comentario: '' }, otros: 'Excelente actitud y disposición para el trabajo en equipo.' },
            { id: 2, evaluador: 'Claudia Vera', empresa: 'Distribuidora Central', rut: '13.456.789-0', periodo: 'Ene 2019 — Feb 2021', no_conoce: false, puntualidad: { val: 4, comentario: '' }, desempeno: { val: 4, comentario: 'Buen desempeño general.' }, confiabilidad: { val: 4, comentario: '' }, otros: '' },
            { id: 3, evaluador: 'Marcelo Pizarro', empresa: 'Pyme Tech Ltda.', rut: '10.111.222-3', periodo: 'Jun 2017 — Dic 2018', no_conoce: false, puntualidad: { val: 3, comentario: 'Algunos retrasos menores durante los primeros meses.' }, desempeno: { val: 3, comentario: '' }, confiabilidad: { val: 4, comentario: '' }, otros: '' },
        ]
    };

    let procesoActual = null;

    // INIT
    document.addEventListener('DOMContentLoaded', () => {
        const user = JSON.parse(localStorage.getItem('hl_user') || '{"nombre":"Demo Reclutador","email":"demo@empresa.cl"}');
        document.getElementById('sidebarNombre').textContent = user.nombre || 'Reclutador';
        document.getElementById('sidebarEmail').textContent = user.email || '';
        cargarProcesos();
        actualizarStats();
    });

    // NAVEGACIÓN
    function mostrarVista(vista) {
        document.querySelectorAll('.vista').forEach(v => v.classList.remove('active'));
        document.getElementById(`vista-${vista}`).classList.add('active');
        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
        if (vista === 'procesos' || vista === 'candidatos' || vista === 'resultados') document.getElementById('nav-procesos').classList.add('active');
        if (vista === 'busqueda') document.getElementById('nav-busqueda').classList.add('active');

        const titulos = { procesos: 'Procesos', candidatos: 'Candidatos', resultados: 'Resultados del candidato', busqueda: 'Buscar por RUT' };
        document.getElementById('topbarTitle').textContent = titulos[vista];

        const acciones = document.getElementById('topbarActions');
        acciones.innerHTML = vista === 'procesos'
            ? `<button class="btn-primary" onclick="abrirModalProceso()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round"><path d="M12 5v14M5 12h14"/></svg>Nuevo proceso</button>`
            : '';
    }

    // PROCESOS
    function cargarProcesos() {
        const tbody = document.getElementById('tablaProcesos');
        tbody.innerHTML = procesos.length
            ? procesos.map(p => `
                <tr>
                    <td><div class="td-name">${p.cargo}</div><div class="td-sub">${p.descripcion}</div></td>
                    <td>${p.candidatos}</td>
                    <td><span class="badge badge-activo">${p.estado}</span></td>
                    <td>${formatFecha(p.fecha)}</td>
                    <td><button class="btn-accion" onclick="verCandidatos(${p.id})">Ver candidatos</button></td>
                </tr>`).join('')
            : `<tr><td colspan="5"><div class="empty-state"><div class="empty-state-title">Sin procesos</div><div class="empty-state-desc">Crea tu primer proceso para comenzar.</div></div></td></tr>`;
    }

    function actualizarStats() {
        document.getElementById('statProcesosActivos').textContent = procesos.filter(p => p.estado === 'Activo').length;
        const todos = Object.values(candidatosPorProceso).flat();
        document.getElementById('statCandidatos').textContent = todos.length;
        document.getElementById('statCompletadas').textContent = todos.filter(c => c.estado === 'Completado').length;
        document.getElementById('statEnProceso').textContent = todos.filter(c => c.estado === 'En proceso').length;
    }

    // CANDIDATOS
    function verCandidatos(procesoId) {
        procesoActual = procesos.find(p => p.id === procesoId);
        document.getElementById('procesoNombre').textContent = procesoActual.cargo;
        document.getElementById('procesoMeta').textContent = `${procesoActual.descripcion} — Creado el ${formatFecha(procesoActual.fecha)}`;

        const candidatos = candidatosPorProceso[procesoId] || [];
        const tbody = document.getElementById('tablaCandidatos');
        tbody.innerHTML = candidatos.length
            ? candidatos.map(c => `
                <tr>
                    <td><div class="td-name">${c.nombre}</div><div class="td-sub">${c.rut}</div></td>
                    <td>${c.empleadores}</td>
                    <td>${c.evaluaciones} / ${c.empleadores}</td>
                    <td><span class="badge badge-${c.estado.toLowerCase().replace(' ', '-')}">${c.estado}</span></td>
                    <td>${(c.estado === 'Completado' || c.estado === 'En proceso')
                        ? `<button class="btn-accion" onclick="verResultados(${c.id})">Ver resultados</button>`
                        : `<span style="font-size:12px;color:var(--subtitulo);">Sin evaluaciones</span>`}
                    </td>
                </tr>`).join('')
            : `<tr><td colspan="5"><div class="empty-state"><div class="empty-state-title">Sin candidatos</div><div class="empty-state-desc">Agrega candidatos a este proceso.</div></div></td></tr>`;

        mostrarVista('candidatos');
    }

    // RESULTADOS
    function verResultados(candidatoId) {
        const candidato = Object.values(candidatosPorProceso).flat().find(c => c.id === candidatoId);
        document.getElementById('resultadoNombre').textContent = candidato.nombre;
        document.getElementById('resultadoMeta').textContent = `${candidato.rut} — ${candidato.evaluaciones} evaluación(es) recibida(s)`;

        const evaluaciones = evaluacionesPorCandidato[candidatoId] || [];
        const validas = evaluaciones.filter(e => !e.no_conoce);

        if (validas.length) {
            ['puntualidad', 'desempeno', 'confiabilidad'].forEach(attr => {
                const prom = (validas.reduce((s, e) => s + e[attr].val, 0) / validas.length).toFixed(1);
                document.getElementById(`prom${attr.charAt(0).toUpperCase() + attr.slice(1)}`).textContent = prom;
                document.getElementById(`barra${attr.charAt(0).toUpperCase() + attr.slice(1)}`).style.width = (prom / 5 * 100) + '%';
            });
        }

        document.getElementById('listaEvaluaciones').innerHTML = evaluaciones.map(e => `
            <div class="evaluacion-card">
                <div class="evaluacion-header">
                    <div>
                        <div class="evaluacion-evaluador">${e.evaluador}</div>
                        <div class="evaluacion-empresa">${e.empresa} — RUT ${e.rut}</div>
                    </div>
                    <div class="evaluacion-fecha">${e.periodo}</div>
                </div>
                <div class="evaluacion-body">
                    ${e.no_conoce
                        ? '<div class="no-conoce-tag">El evaluador indicó no conocer o no haber trabajado con este candidato.</div>'
                        : `<div class="eval-atributos">
                            ${['puntualidad', 'desempeno', 'confiabilidad'].map(attr => `
                                <div>
                                    <div class="eval-atributo-label">${attr === 'desempeno' ? 'Desempeño' : attr.charAt(0).toUpperCase() + attr.slice(1)}</div>
                                    <div class="eval-score">
                                        <span class="eval-score-num">${e[attr].val}</span>
                                        <div class="eval-score-bar"><div class="eval-score-fill" style="width:${e[attr].val / 5 * 100}%"></div></div>
                                    </div>
                                    <div class="eval-score-texto">${escalaTextos[e[attr].val]}</div>
                                    ${e[attr].comentario ? `<div class="eval-comentario">${e[attr].comentario}</div>` : ''}
                                </div>`).join('')}
                           </div>
                           ${e.otros ? `<div class="eval-otros"><div class="eval-otros-label">Otros comentarios</div><div class="eval-otros-texto">${e.otros}</div></div>` : ''}`
                    }
                </div>
            </div>`).join('');

        mostrarVista('resultados');
    }

    // BÚSQUEDA RUT
    document.getElementById('rutBusqueda').addEventListener('input', function (e) {
        let v = e.target.value.replace(/[^0-9kK]/g, '');
        if (v.length > 1) { e.target.value = v.slice(0, -1).replace(/\B(?=(\d{3})+(?!\d))/g, '.') + '-' + v.slice(-1).toUpperCase(); }
        else e.target.value = v;
    });

    function buscarPorRut() {
        const rut = document.getElementById('rutBusqueda').value.trim();
        const contenedor = document.getElementById('resultadoBusqueda');
        if (!rut) return;

        const candidato = Object.values(candidatosPorProceso).flat().find(c => c.rut === rut);

        if (!candidato) {
            contenedor.innerHTML = `<div class="table-card" style="padding:32px; text-align:center;"><div class="empty-state-title">Sin resultados</div><div class="empty-state-desc" style="margin-top:6px;">No se encontró ningún trabajador con el RUT <strong>${rut}</strong>.</div></div>`;
            return;
        }

        const evals = (evaluacionesPorCandidato[candidato.id] || []).filter(e => !e.no_conoce).length;
        contenedor.innerHTML = `
            <div>
                <div style="font-size:13px; color:var(--subtitulo); margin-bottom:12px;">Resultado para <strong>${rut}</strong></div>
                <div class="candidato-header" style="border-radius:4px 4px 0 0; margin-bottom:0;">
                    <div class="candidato-avatar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="8" r="4"/>
                            <path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/>
                        </svg>
                    </div>
                    <div>
                        <div class="candidato-nombre">${candidato.nombre}</div>
                        <div class="candidato-meta">${candidato.rut} — ${evals} evaluación(es) válida(s)</div>
                    </div>
                </div>
                <div style="background:var(--fondo); border:1px solid var(--borde); border-top:none; border-radius:0 0 4px 4px; padding:20px;">
                    <button class="btn-primary" onclick="verResultados(${candidato.id})">Ver evaluaciones completas</button>
                </div>
            </div>`;
    }

    // MODALES
    function abrirModalProceso() { document.getElementById('modalProceso').classList.add('visible'); }
    function cerrarModalProceso() { document.getElementById('modalProceso').classList.remove('visible'); }
    function abrirModalCandidato() { document.getElementById('modalCandidato').classList.add('visible'); }
    function cerrarModalCandidato() { document.getElementById('modalCandidato').classList.remove('visible'); }

    function crearProceso() {
        const cargo = document.getElementById('nuevoProcesoCargo').value.trim();
        if (!cargo) return;
        const nuevo = { id: procesos.length + 1, cargo, descripcion: document.getElementById('nuevoProcesoDesc').value.trim(), estado: 'Activo', fecha: new Date().toISOString().split('T')[0], candidatos: 0 };
        procesos.unshift(nuevo);
        candidatosPorProceso[nuevo.id] = [];
        cargarProcesos();
        actualizarStats();
        cerrarModalProceso();
        document.getElementById('nuevoProcesoCargo').value = '';
        document.getElementById('nuevoProcesoDesc').value = '';
    }

    function agregarCandidato() {
        const nombre = document.getElementById('candNombre').value.trim();
        const rut = document.getElementById('candRut').value.trim();
        const email = document.getElementById('candEmail').value.trim();
        if (!nombre || !rut || !email) return;
        const nuevo = { id: Date.now(), nombre, rut, email, empleadores: 0, evaluaciones: 0, estado: 'Invitado' };
        candidatosPorProceso[procesoActual.id].push(nuevo);
        procesoActual.candidatos++;
        verCandidatos(procesoActual.id);
        cerrarModalCandidato();
        document.getElementById('candNombre').value = '';
        document.getElementById('candRut').value = '';
        document.getElementById('candEmail').value = '';
    }

    function formatFecha(f) {
        return new Date(f).toLocaleDateString('es-CL', { day: '2-digit', month: 'short', year: 'numeric' });
    }

    function cerrarSesion() {
        localStorage.removeItem('hl_token');
        localStorage.removeItem('hl_user');
        window.location.href = 'login.html';
    }
</script>

</body>
</html>
